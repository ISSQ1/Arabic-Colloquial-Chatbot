from fastapi import FastAPI
from pydantic import BaseModel
from nltk.chat.util import Chat
from fastapi.middleware.cors import CORSMiddleware

# ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุฑุฏูุฏ
responses = [
    [
        r"(.*)ูุฑุญุจุง(.*)",
        ["ุฃููุง ูุณููุง , ููู ุฃูุฏุฑ ุฃุณุงุนุฏูุ"],
    ],
    [
        r"(.*)ุณูุงู(.*)",
        ["ูุนูููู ุงูุณูุงู ูุฑุญูุฉ ุงููู ูุจุฑูุงุชูุ ููู ุฃูุฏุฑ ุฃุณุงุนุฏูุ"],
    ],
    [
        r"(.*)ูู ุฃูุช(.*)",
        ["ุฃูุง ุดุฐูุ ููุง ุนุดุงู ุฃุณุงุนุฏู ูู ุงูุฑุฏ ุนูู ุงููุตุทูุญุงุช ุงูุนุงููุฉ. ุงูุชุจ ุฃู ูุตุทูุญ ูุฃูุง ุฑุญ ุฃูุฏู ูู ุงูุฑุฏ ุงูููุงุณุจ"]
    ],
    [
        r"(.*)ุนูู ุฎุดูู(.*)",
        ["ุนููู ุงูุทูุจ"]
    ],
    [
        r"(.*)ุญูุงู ุงููู(.*)",
        ["ุงููู ูุญูู ููุจููู ุฃู ุงููู ูุณููู"]
    ],
    [
        r"(.*)(ุงูุฑู|ุงูุฑ|ุชุงูุฑู|ุชุญุช ุงูุฑู)(.*)",
        ["ูุง ูุงูุฑ ุนููู ุนุฏู ุฃู ุชุณูู ูุงูุบุงูู"]
    ],
    [
        r"(.*)ุฌูุนุฉ ุทูุจู(.*)",
        ["ูุง ูุงูุฑ ุนููู ุนุฏู ุฃู ุทุจุช ูุทุงุจ ุญุงูู"]
    ],
    [
        r"(.*)(ูุฏูุชู|ูุฏุงู|ูุฏุง|ูุฏูู)(.*)",
        ["ููุฏุงู ุงูููู ููู ูุง ุงูุบุงูู"]
    ],
    [
        r"(.*)(ุงููุนู|ุงูุนู)(.*)",
        ["ูุง ุนููู ุฒูุฏ ุฃู ุงููุนู ุจุญุงูู"]
    ],
    [
        r"(.*)ุณู(.*)",
        ["ุณู ุงููู ุนุฏูู"]
    ],
    [
        r"(.*)ูุง ุชุดูู ุดุฑ(.*)",
        ["ุงูุดุฑ ูุง ูุฌูู"]
    ],
    [
        r"(.*)ุฃุฑุญุจ(.*)",
        ["ุงููู ูุณููู ููุณุนุฏู ุฃู ุงููู ูุฑูุน ูุฏุฑู ููุญููู"]
    ],
    [
        r"(.*)ุจุดุฑ(.*)",
        ["ุงููู ูุจุดุฑู ุจูู ุฎูุฑ"]
    ],
    [
        r"(.*)(ุนุฒ ุงููู ููุงูู|ุนุฒ ุงููู ููุงูู)(.*)",
        ["ููุงู ุนุฒูุฒ"]
    ],
    [
        r"(.*)ูุงููุช(.*)",
        ["ููุง ุชููู"]
    ],
    [
        r"(.*)ุนุณู ูุงุฎูุงู(.*)",
        ["ุงููู ูุณูููุ ูู ุดูุก ุนูู ูุง ูุฑุงู"]
    ],
    [
        r"(.*)ูุงุฌูุฑ(.*)",
        ["ุณููุช"]
    ],
    [
        r"(.*)(ุงููู ููุฑูู|ูุฑูุช|ุงูุฑู)(.*)",
        ["ุณููุช ูุฏูุช ุฃู ุงู ูุงู ุจุนุฏ ูุฌุจุฉ ุทุนุงู ูููู ุชุฑุฏ: ุจุงูุนุงููุฉ"]
    ],
    [
        r"(.*)(ุงููู ูุชูุจู|ุชูุจู ุงููู)(.*)",
        ["ููุง ูููู"]
    ],
    [
        r"(.*)ุชุดุฑููุง(.*)",
        ["ุงูุดุฑู ูู ุงููู ูุณุนุฏู"]
    ],
    [
        r"(.*)",  # ุงูููุท ุงูุงูุชุฑุงุถู ูุนุฏู ุงูุนุซูุฑ ุนูู ุฑุฏ
        ["ูู ุฃูููุ ูู ููููู ุฅุนุงุฏุฉ ุตูุงุบุฉ ุณุคุงููุ"]
    ]
]


# ุชุนุฑูู ุงูุดุงุช ุจูุช
class CustomChat(Chat):
    def respond(self, statement):
        # ุฅุถุงูุฉ ูููุฉ "ุฃูุช" ูุจู ุฅุฏุฎุงู ุงููุณุชุฎุฏู ู"ุดุฐู" ูุจู ุงูุฑุฏ
        print(f"ุฃูุช: {statement}")
        response = super().respond(statement)
        return f"ุดุฐู: {response}" 

# ุฅูุดุงุก ุงูุดุงุช ุจูุช
chat = CustomChat(responses)

app=FastAPI()

app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # ูุณูุญ ูุฌููุน ุงููุตุงุฏุฑ
    allow_credentials=True,
    allow_methods=["*"],  # ูุณูุญ ุจุฌููุน ุงูุทุฑู (GET, POSTุ ุฅูุฎ)
    allow_headers=["*"],  # ูุณูุญ ุจุฌููุน ุงูุฑุคูุณ
)

# ุชุนุฑูู ูููุฐุฌ ุงูุฅุฏุฎุงู
class Message(BaseModel):
    text: str

@app.post("/Arabic_Chatbot/")
def get_response(message: Message):
    try:
        user_input = message.text
        bot_response = chat.respond(user_input)
        return {"response": bot_response}
    except Exception as e:
        return {"response": f"ุญุฏุซ ุฎุทุฃ: {str(e)}"}


@app.get("/")
def read_root():
    return {"message": "ุฃููุงู ูุณููุงู! ุฃูุง ุดุฐูุ ุงูุตุฏููุฉ ุงูุฐููุฉ ุงููู ููุง ุนุดุงู ุชููุฐู ูู ูู ูุฑุฉ ุชููู ูููุง ูุญุชุงุฑ ููู ุชุฑุฏ ุนูู ุงููุตุทูุญุงุช ุงูุนุงููุฉ. ุฅุฐุง ุงุญุชุฌุช ูุฃู ูุณุงุนุฏุฉุ ููุท ุงูุชุจ ูู ูุณุฃููู ููุง ูุฃุณุงุนุฏู ุจุฃูุถู ูุง ุนูุฏู. ๐"}
